<!-- base.html -->
<!DOCTYPE html>
<html lang="en">
  <head>
    {% csrf_token %}
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>AI Kitchen - Smart Restaurant Management</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <style>
      .stats-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05);
      }

      /* Modal transitions */
      .modal-enter {
        opacity: 0;
      }
      .modal-enter-active {
        opacity: 1;
        transition: opacity 200ms;
      }
      .modal-exit {
        opacity: 1;
      }
      .modal-exit-active {
        opacity: 0;
        transition: opacity 200ms;
      }

      /* Camera feed styling */
      #cameraFeed {
        background-color: #f3f4f6;
        max-height: 400px;
        display: block;
        margin: 0 auto;
      }

      /* Drag and drop highlight */
      .border-dashed {
        transition: all 0.2s ease;
      }
    </style>
  </head>
  <body class="bg-gray-50">
    <!-- Navbar -->
    <nav class="bg-white shadow-md">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex justify-between h-16">
          <div class="flex">
            <div class="flex-shrink-0 flex items-center">
              <i class="fas fa-utensils text-indigo-600 text-2xl mr-2"></i>
              <span class="font-bold text-xl text-indigo-600">AI Kitchen</span>
            </div>
            <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
              <a
                href="/"
                class="border-indigo-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium"
              >
                Dashboard
              </a>
              <a
                href="{% url 'inventory' %}"
                class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium"
              >
                Inventory
              </a>
              <a
                href="#"
                class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium"
              >
                Waste Management
              </a>
              <a
                href="#"
                class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium"
              >
                Menu Optimization
              </a>
              <a
                href="#"
                class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium"
              >
                Analytics
              </a>
              <a
                href="#"
                class="border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium"
              >
                Settings
              </a>
            </div>
          </div>
          <div class="hidden sm:ml-6 sm:flex sm:items-center">
            <button
              class="bg-white p-1 rounded-full text-gray-400 hover:text-gray-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
            >
              <span class="sr-only">View notifications</span>
              <i class="fas fa-bell"></i>
            </button>
            <div class="ml-3 relative">
              <div>
                <button
                  class="max-w-xs bg-white flex items-center text-sm rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                >
                  <span class="sr-only">Open user menu</span>
                  <img
                    class="h-8 w-8 rounded-full"
                    src="https://images.unsplash.com/photo-1472099645785-5658abf4ff4e?ixlib=rb-1.2.1&ixid=eyJhcHBfaWQiOjEyMDd9&auto=format&fit=facearea&facepad=2&w=256&h=256&q=80"
                    alt=""
                  />
                </button>
              </div>
            </div>
          </div>
          <div class="-mr-2 flex items-center sm:hidden">
            <button
              type="button"
              class="bg-white inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-indigo-500"
            >
              <span class="sr-only">Open main menu</span>
              <i class="fas fa-bars"></i>
            </button>
          </div>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
      <!-- Welcome Section -->
      <div class="mb-8">
        <h1 class="text-3xl font-bold text-gray-900">Welcome to AI Kitchen</h1>
        <p class="mt-2 text-gray-600">
          Smart restaurant management powered by AI. Minimize waste, maximize
          efficiency.
        </p>
      </div>

      <!-- Stats Overview -->
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
        <div
          class="bg-white overflow-hidden shadow rounded-lg transition-all duration-300 stats-card"
        >
          <div class="p-5">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-indigo-500 rounded-md p-3">
                <i class="fas fa-chart-line text-white"></i>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">
                    Today's Revenue
                  </dt>
                  <dd>
                    <div class="text-lg font-medium text-gray-900">
                      $4,282.40
                    </div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-5 py-3">
            <div class="text-sm">
              <a
                href="#"
                class="font-medium text-indigo-600 hover:text-indigo-500"
                >View details</a
              >
            </div>
          </div>
        </div>

        <div
          class="bg-white overflow-hidden shadow rounded-lg transition-all duration-300 stats-card"
        >
          <div class="p-5">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-green-500 rounded-md p-3">
                <i class="fas fa-box text-white"></i>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">
                    Inventory Health
                  </dt>
                  <dd>
                    <div class="text-lg font-medium text-gray-900">92%</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-5 py-3">
            <div class="text-sm">
              <a
                href="#"
                class="font-medium text-indigo-600 hover:text-indigo-500"
                >View details</a
              >
            </div>
          </div>
        </div>

        <div
          class="bg-white overflow-hidden shadow rounded-lg transition-all duration-300 stats-card"
        >
          <div class="p-5">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-red-500 rounded-md p-3">
                <i class="fas fa-trash-alt text-white"></i>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">
                    Waste This Week
                  </dt>
                  <dd>
                    <div class="text-lg font-medium text-gray-900">3.2%</div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-5 py-3">
            <div class="text-sm">
              <a
                href="#"
                class="font-medium text-indigo-600 hover:text-indigo-500"
                >View details</a
              >
            </div>
          </div>
        </div>

        <div
          class="bg-white overflow-hidden shadow rounded-lg transition-all duration-300 stats-card"
        >
          <div class="p-5">
            <div class="flex items-center">
              <div class="flex-shrink-0 bg-yellow-500 rounded-md p-3">
                <i class="fas fa-utensils text-white"></i>
              </div>
              <div class="ml-5 w-0 flex-1">
                <dl>
                  <dt class="text-sm font-medium text-gray-500 truncate">
                    Popular Items
                  </dt>
                  <dd>
                    <div class="text-lg font-medium text-gray-900">
                      12 items
                    </div>
                  </dd>
                </dl>
              </div>
            </div>
          </div>
          <div class="bg-gray-50 px-5 py-3">
            <div class="text-sm">
              <a
                href="#"
                class="font-medium text-indigo-600 hover:text-indigo-500"
                >View details</a
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Main Sections -->
      {% comment %}
      <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Inventory Alerts -->
        <div class="bg-white shadow rounded-lg">
          <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
            <h3
              class="text-lg leading-6 font-medium text-gray-900 flex items-center"
            >
              <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
              Inventory Alerts
            </h3>
          </div>
          <div class="p-4">
            <ul class="divide-y divide-gray-200">
              <li class="py-3">
                <div class="flex items-center">
                  <div class="min-w-0 flex-1">
                    <p class="text-sm font-medium text-gray-900 truncate">
                      Tomatoes
                    </p>
                    <p class="text-sm text-gray-500">
                      Low stock - 2.3 kg remaining
                    </p>
                  </div>
                  <div>
                    <button
                      class="bg-indigo-100 text-indigo-700 py-1 px-3 rounded-full text-xs font-medium"
                    >
                      Order
                    </button>
                  </div>
                </div>
              </li>
              <li class="py-3">
                <div class="flex items-center">
                  <div class="min-w-0 flex-1">
                    <p class="text-sm font-medium text-gray-900 truncate">
                      Chicken Breast
                    </p>
                    <p class="text-sm text-gray-500">
                      Expiring in 2 days - 5.4 kg
                    </p>
                  </div>
                  <div>
                    <button
                      class="bg-red-100 text-red-700 py-1 px-3 rounded-full text-xs font-medium"
                    >
                      Use Soon
                    </button>
                  </div>
                </div>
              </li>
              <li class="py-3">
                <div class="flex items-center">
                  <div class="min-w-0 flex-1">
                    <p class="text-sm font-medium text-gray-900 truncate">
                      Olive Oil
                    </p>
                    <p class="text-sm text-gray-500">
                      Low stock - 1 bottle remaining
                    </p>
                  </div>
                  <div>
                    <button
                      class="bg-indigo-100 text-indigo-700 py-1 px-3 rounded-full text-xs font-medium"
                    >
                      Order
                    </button>
                  </div>
                </div>
              </li>
              <li class="py-3">
                <div class="flex items-center">
                  <div class="min-w-0 flex-1">
                    <p class="text-sm font-medium text-gray-900 truncate">
                      Bell Peppers
                    </p>
                    <p class="text-sm text-gray-500">
                      Predict spoilage - 3 days left
                    </p>
                  </div>
                  <div>
                    <button
                      class="bg-yellow-100 text-yellow-700 py-1 px-3 rounded-full text-xs font-medium"
                    >
                      Use Now
                    </button>
                  </div>
                </div>
              </li>
            </ul>
            <div class="mt-4">
              <a
                href="#"
                class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
                >View all alerts <i class="fas fa-arrow-right ml-1"></i
              ></a>
            </div>
          </div>
        </div>
        {% endcomment %}

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
          <!-- Inventory Alerts -->
          <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
              <h3
                class="text-lg leading-6 font-medium text-gray-900 flex items-center"
              >
                <i class="fas fa-exclamation-triangle text-yellow-500 mr-2"></i>
                Inventory Alerts
              </h3>
            </div>
            <div class="p-4">
              <ul id="inventoryAlertsList" class="divide-y divide-gray-200 capitalize "></ul>
              <div class="mt-4">
                <button onclick="openModal()" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">
                  View all alerts <i class="fas fa-arrow-right ml-1"></i>
              </button>
              </div>
            </div>
          </div>

          <!-- Tailwind Modal -->
          <div
            id="inventoryModal"
            class="fixed inset-0 bg-gray-800 bg-opacity-50 hidden flex justify-center items-center z-50"
          >
            <div class="bg-white rounded-lg shadow-lg w-96 max-w-full z-50">
              <div class="p-4 border-b flex justify-between items-center">
                <h3 class="text-lg font-medium text-gray-900">
                  All Inventory Alerts
                </h3>
                <button
                  onclick="close_inv_modal()"
                  class="text-gray-400 hover:text-gray-600"
                >
                  &times;
                </button>
              </div>
              <div class="p-4 max-h-60 overflow-y-auto">
                <ul
                  id="modalInventoryList"
                  class="divide-y divide-gray-200"
                ></ul>
              </div>
              <div class="p-4 text-right border-t">
                <button
                  onclick="close_inv_modal()"
                  class="px-4 py-2 bg-gray-300 rounded-md hover:bg-gray-400"
                >
                  Close
                </button>
              </div>
            </div>
          </div>

          <!-- Waste Reduction -->
          {% comment %} <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
              <h3
                class="text-lg leading-6 font-medium text-gray-900 flex items-center"
              >
                <i class="fas fa-leaf text-green-500 mr-2"></i>
                Waste Reduction Opportunities
              </h3>
            </div>
            <div class="p-4">
              <div class="mb-4">
                <div class="relative pt-1">
                  <div class="flex mb-2 items-center justify-between ">
                    <div>
                      <span class="text-sm font-medium text-gray-900"
                        >Weekly Waste Goal</span
                      >
                    </div>
                    <div class="text-right">
                      <span class="text-sm font-semibold text-indigo-700"
                        >3.2% / 3.0%</span
                      >
                    </div>
                  </div>
                  <div
                    class="overflow-hidden h-2 text-xs flex rounded bg-indigo-200"
                  >
                    <div
                      style="width: 93%"
                      class="shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-indigo-500"
                    ></div>
                  </div>
                </div>
              </div>
              <ul class="divide-y divide-gray-200">
                <li class="py-3">
                  <div class="flex items-center">
                    <div class="min-w-0 flex-1">
                      <p class="text-sm font-medium text-gray-900">
                        Modify Seafood Order
                      </p>
                      <p class="text-sm text-gray-500">
                        Reduce by 15% based on consumption data
                      </p>
                    </div>
                    <div>
                      <span
                        class="bg-green-100 text-green-700 py-1 px-3 rounded-full text-xs font-medium"
                        >-$120/wk</span
                      >
                    </div>
                  </div>
                </li>
                <li class="py-3">
                  <div class="flex items-center">
                    <div class="min-w-0 flex-1">
                      <p class="text-sm font-medium text-gray-900">
                        Special: Vegetable Soup
                      </p>
                      <p class="text-sm text-gray-500">
                        Utilize aging produce inventory
                      </p>
                    </div>
                    <div>
                      <span
                        class="bg-green-100 text-green-700 py-1 px-3 rounded-full text-xs font-medium"
                        >-$85/wk</span
                      >
                    </div>
                  </div>
                </li>
                <li class="py-3">
                  <div class="flex items-center">
                    <div class="min-w-0 flex-1">
                      <p class="text-sm font-medium text-gray-900">
                        Portion Size Adjustment
                      </p>
                      <p class="text-sm text-gray-500">
                        Reduce pasta portions by 10%
                      </p>
                    </div>
                    <div>
                      <span
                        class="bg-green-100 text-green-700 py-1 px-3 rounded-full text-xs font-medium"
                        >-$65/wk</span
                      >
                    </div>
                  </div>
                </li>
              </ul>
              <div class="mt-4">
                <a
                  href="#"
                  class="text-sm font-medium text-indigo-600 hover:text-indigo-500"
                  >View all opportunities <i class="fas fa-arrow-right ml-1"></i
                ></a>
              </div>
            </div>
          </div> {% endcomment %}
          <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                <h3 class="text-lg leading-6 font-medium text-gray-900 flex items-center">
                    <i class="fas fa-leaf text-green-500 mr-2"></i>
                    Waste Reduction Opportunities
                </h3>
            </div>
            <div class="p-4">
                <ul id="waste-opportunities-list" class="divide-y divide-gray-200">
                    <!-- Waste reduction items will load here -->
                </ul>
            </div>
        </div>
        
        

          <!-- Menu Performance -->
          <div class="bg-white shadow rounded-lg">
            <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
                <h3 class="text-lg leading-6 font-medium text-gray-900 flex items-center">
                    <i class="fas fa-chart-pie text-purple-500 mr-2"></i> Menu Performance
                </h3>
            </div>
            <div class="p-4">

                <div class="space-y-3">
        
                    <!-- Top Performers Section -->
                    <div class="bg-green-50 p-3 rounded-lg">
                        <p class="text-sm font-medium text-gray-900">Top Performers</p>
                        <ul id="top-performers-list" class="mt-2 space-y-2">
                           
                        </ul>
                    </div>
        
                    <!-- Underperforming Section -->
                    <div class="bg-red-50 p-3 rounded-lg">
                        <p class="text-sm font-medium text-gray-900">Underperforming</p>
                        <ul id="underperforming-list" class="mt-2 space-y-2">
                            <!-- Dynamic Data Will Be Inserted Here -->
                        </ul>
                    </div>
        
                    <!-- AI Recommendations (Static) -->
                    <div class="bg-yellow-50 p-3 rounded-lg">
                        <p class="text-sm font-medium text-gray-900"> Recommendations</p>
                        <ul class="mt-2 space-y-2">
                            <li class="text-sm text-gray-700">Add seasonal special: "Summer Berry Dessert"</li>
                            <li class="text-sm text-gray-700">Price reduction on Vegetable Curry (-10%)</li>
                            <li class="text-sm text-gray-700">Feature Truffle Pasta in weekend promotions</li>
                        </ul>
                    </div>
        
                </div>

                <div class="mt-4">
                    <a href="#" class="text-sm font-medium text-indigo-600 hover:text-indigo-500">
                        View detailed analysis <i class="fas fa-arrow-right ml-1"></i>
                    </a>
                </div>
            </div>
        </div>
      </div>
        
      <!-- Usage & Training Section -->

      <div class="mt-8 bg-white shadow rounded-lg overflow-hidden">
        <div class="px-4 py-5 sm:px-6 border-b border-gray-200">
          <h3
            class="text-lg leading-6 font-medium text-gray-900 flex items-center"
          >
            <i class="fas fa-robot text-indigo-500 mr-2"></i>
            AI System Status
          </h3>
        </div>
        <div class="p-4">
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="bg-gray-50 p-4 rounded-lg">
              <h4 class="font-medium text-gray-900 mb-2">Computer Vision</h4>
              <div class="flex items-center mb-2">
                <div class="w-2/3 bg-gray-200 rounded-full h-2.5">
                  <div
                    class="bg-green-600 h-2.5 rounded-full"
                    style="width: 95%"
                  ></div>
                </div>
                <span class="ml-2 text-sm text-gray-700">95%</span>
              </div>
              <p class="text-xs text-gray-500">
                Recognition accuracy for inventory items
              </p>
              <div class="mt-2">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800"
                >
                  <i class="fas fa-check-circle mr-1"></i> Operating normally
                </span>
              </div>
            </div>


            <div class="bg-gray-50 p-4 rounded-lg">
              <h4 class="font-medium text-gray-900 mb-2">Prediction Model</h4>
              <div class="flex items-center mb-2">
                <div class="w-2/3 bg-gray-200 rounded-full h-2.5">
                  <div
                    class="bg-yellow-500 h-2.5 rounded-full"
                    style="width: 82%"
                  ></div>
                </div>
                <span class="ml-2 text-sm text-gray-700">82%</span>
              </div>
              <p class="text-xs text-gray-500">
                Accuracy of food spoilage predictions
              </p>
              <div class="mt-2">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-yellow-100 text-yellow-800"
                >
                  <i class="fas fa-sync-alt mr-1"></i> Training in progress
                </span>
              </div>
            </div>

            <div class="bg-gray-50 p-4 rounded-lg">
              <h4 class="font-medium text-gray-900 mb-2">Menu Optimization</h4>
              <div class="flex items-center mb-2">
                <div class="w-2/3 bg-gray-200 rounded-full h-2.5">
                  <div
                    class="bg-blue-600 h-2.5 rounded-full"
                    style="width: 88%"
                  ></div>
                </div>
                <span class="ml-2 text-sm text-gray-700">88%</span>
              </div>
              <p class="text-xs text-gray-500">
                Recommendation relevance score
              </p>
              <div class="mt-2">
                <span
                  class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800"
                >
                  <i class="fas fa-cog mr-1"></i> Optimizing
                </span>
              </div>
            </div>
          </div>

          <div class="mt-4 pt-4 border-t border-gray-200">
            <div class="flex justify-between items-center">
              <span class="text-sm text-gray-500"
                >Last system update: Today, 8:45 AM</span
              >

              <button
                id="scanButton"
                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700"
                
              >
                <i class="fas fa-camera mr-2"></i> Upload Image
              </button>

              <!-- Image Upload/Capture Modal -->
              <div
                id="imageModal"
                class="fixed z-10 inset-0 overflow-y-auto hidden"
              >
                <div
                  class="flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0"
                >
                  <div
                    class="fixed inset-0 transition-opacity"
                    aria-hidden="true"
                  >
                    <div class="absolute inset-0 bg-gray-500 opacity-75"></div>
                  </div>

                  <span
                    class="hidden sm:inline-block sm:align-middle sm:h-screen"
                    aria-hidden="true"
                    >&#8203;</span
                  >

                  <div
                    class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full"
                  >
                    <div class="bg-white px-4 pt-5 pb-4 sm:p-6 sm:pb-4">
                      <div class="sm:flex sm:items-start">
                        <div
                          class="mt-3 text-center sm:mt-0 sm:ml-4 sm:text-left w-full"
                        >
                          <h3
                            class="text-lg leading-6 font-medium text-gray-900"
                            id="modalTitle"
                          >
                            Upload or Capture Image
                          </h3>
                          <div class="mt-4">
                            <!-- Tab Navigation -->
                            <div class="border-b border-gray-200">
                              <nav class="-mb-px flex space-x-8">
                                <button
                                  id="uploadTab"
                                  class="border-indigo-500 text-indigo-600 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
                                >
                                  Upload Image
                                </button>
                                <button
                                  id="captureTab"
                                  class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm"
                                >
                                  Capture Image
                                </button>
                              </nav>
                            </div>

                            <!-- Upload Tab Content -->
                            <div id="uploadContent" class="mt-4">
                              <div
                                class="mt-2 flex justify-center px-6 pt-5 pb-6 border-2 border-gray-300 border-dashed rounded-md"
                              >
                                <div class="space-y-1 text-center">
                                  <div class="flex text-sm text-gray-600">
                                    <label
                                      for="file-upload"
                                      class="relative cursor-pointer bg-white rounded-md font-medium text-indigo-600 hover:text-indigo-500 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-indigo-500"
                                    >
                                      <span>Upload a file</span>
                                      <input
                                        id="file-upload"
                                        name="file-upload"
                                        type="file"
                                        class="sr-only"
                                        accept="image/*"
                                      />
                                    </label>
                                    <p class="pl-1">or drag and drop</p>
                                  </div>
                                  <p class="text-xs text-gray-500">
                                    PNG, JPG, GIF up to 10MB
                                  </p>
                                </div>
                              </div>
                              <div id="previewContainer" class="mt-4 hidden">
                                <img
                                  id="imagePreview"
                                  src="#"
                                  alt="Preview"
                                  class="max-h-60 mx-auto"
                                />
                                <div class="mt-4 flex justify-end">
                                  <button
                                    id="cancelUpload"
                                    type="button"
                                    class="mr-2 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                  >
                                    Cancel
                                  </button>
                                  <button
                                    id="confirmUpload"
                                    type="button"
                                    class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                  >
                                    Confirm Upload
                                  </button>
                                </div>
                              </div>
                            </div>

                            <!-- Capture Tab Content -->
                            <div id="captureContent" class="mt-4 hidden">
                              <div class="relative" id="cameraFeedDiv">
                                <video
                                  id="cameraFeed"
                                  class="w-full h-auto rounded-md"
                                  autoplay
                                  playsinline
                                ></video>
                                <canvas
                                  id="photoCanvas"
                                  class="hidden"
                                ></canvas>
                              </div>
                              <div class="mt-4 flex justify-center">
                                <button
                                  id="takePhoto"
                                  class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                >
                                  <i class="fas fa-camera mr-2"></i> Take Photo
                                </button>
                              </div>
                              <div
                                id="photoPreviewContainer"
                                class="mt-4 hidden"
                              >
                                <img
                                  id="photoPreview"
                                  src="#"
                                  alt="Captured Photo"
                                  class="max-h-60 mx-auto"
                                />
                                <div class="mt-4 flex justify-end">
                                  <button
                                    id="retakePhoto"
                                    type="button"
                                    class="mr-2 inline-flex justify-center py-2 px-4 border border-gray-300 shadow-sm text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                  >
                                    Retake
                                  </button>
                                  <button
                                    id="confirmPhoto"
                                    type="button"
                                    class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500"
                                  >
                                    Use Photo
                                  </button>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div
                      class="bg-gray-50 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse"
                    >
                      <button
                        id="closeModal"
                        type="button"
                        class="mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm"
                      >
                        Close
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200">
      <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <!-- Company Info -->
          <div>
            <div class="flex items-center">
              <i class="fas fa-utensils text-indigo-600 text-xl mr-2"></i>
              <span class="text-indigo-600 font-semibold text-lg"
                >AI Kitchen</span
              >
            </div>
            <p class="mt-4 text-sm text-gray-500">
              Crafting culinary experiences with artificial intelligence since
              2023.
            </p>
          </div>

          <!-- Quick Links -->
          <div>
            <h3
              class="text-sm font-semibold text-gray-700 tracking-wider uppercase"
            >
              Quick Links
            </h3>
            <ul class="mt-4 space-y-2">
              <li>
                <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
                  >Home</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
                  >About Us</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
                  >Services</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
                  >Blog</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
                  >Contact</a
                >
              </li>
            </ul>
          </div>

          <!-- Legal -->
          <div>
            <h3
              class="text-sm font-semibold text-gray-700 tracking-wider uppercase"
            >
              Legal
            </h3>
            <ul class="mt-4 space-y-2">
              <li>
                <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
                  >Privacy Policy</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
                  >Terms of Service</a
                >
              </li>
              <li>
                <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
                  >Cookie Policy</a
                >
              </li>
            </ul>
          </div>

          <table>
            <thead>
              <tr>
                <th>Item Name</th>
                <th>Quantity</th>
                <th>Date Added</th>
                <!-- New column for Date -->
              </tr>
            </thead>
            <tbody id="inventoryTableBody">
              <!-- Inventory data will be populated here -->
            </tbody>
          </table>

          <table>
            <thead>
              <tr>
                <th>Waste Name</th>
                <th>Quantity</th>
              </tr>
            </thead>
            <tbody id="wasteTableBody">
              <!-- Waste data will be populated here -->
            </tbody>
          </table>

          <!-- Connect with Us -->
          <div>
            <h3
              class="text-sm font-semibold text-gray-700 tracking-wider uppercase"
            >
              Connect with Us
            </h3>
            <div class="mt-4 flex space-x-4">
              <a href="#" class="text-gray-500 hover:text-indigo-600">
                <i class="fab fa-facebook text-xl"></i>
              </a>
              <a href="#" class="text-gray-500 hover:text-indigo-600">
                <i class="fab fa-twitter text-xl"></i>
              </a>
              <a href="#" class="text-gray-500 hover:text-indigo-600">
                <i class="fab fa-instagram text-xl"></i>
              </a>
              <a href="#" class="text-gray-500 hover:text-indigo-600">
                <i class="fab fa-linkedin text-xl"></i>
              </a>
            </div>
            <div class="mt-4">
              <h4 class="text-sm font-medium text-gray-700">
                Subscribe to our newsletter
              </h4>
              <div class="mt-2 flex">
                <input
                  type="email"
                  placeholder="Enter your email"
                  class="px-3 py-2 border border-gray-300 rounded-l-md w-full text-sm"
                />
                <button
                  class="bg-indigo-600 text-white px-3 py-2 rounded-r-md text-sm hover:bg-indigo-700"
                >
                  Subscribe
                </button>
              </div>
            </div>
          </div>
        </div>

        <div
          class="mt-8 border-t border-gray-200 pt-8 md:flex md:items-center md:justify-between"
        >
          <div class="flex space-x-6 md:order-2">
            <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
              >Sitemap</a
            >
            <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
              >Accessibility</a
            >
            <a href="#" class="text-sm text-gray-500 hover:text-indigo-600"
              >FAQ</a
            >
          </div>
          <p class="mt-8 text-sm text-gray-500 md:mt-0 md:order-1">
            © 2025 AI Kitchen. All rights reserved.
          </p>
        </div>
      </div>
    </footer>

    <script>
      // Modal functionality
      const modal = document.getElementById("imageModal");
      const uploadTab = document.getElementById("uploadTab");
      const captureTab = document.getElementById("captureTab");
      const uploadContent = document.getElementById("uploadContent");
      const captureContent = document.getElementById("captureContent");
      const fileUpload = document.getElementById("file-upload");
      const imagePreview = document.getElementById("imagePreview");
      const previewContainer = document.getElementById("previewContainer");
      const cancelUpload = document.getElementById("cancelUpload");
      const confirmUpload = document.getElementById("confirmUpload");
      const cameraFeed = document.getElementById("cameraFeed");
      const takePhoto = document.getElementById("takePhoto");
      const photoCanvas = document.getElementById("photoCanvas");
      const photoPreview = document.getElementById("photoPreview");
      const photoPreviewContainer = document.getElementById(
        "photoPreviewContainer"
      );
      const retakePhoto = document.getElementById("retakePhoto");
      const confirmPhoto = document.getElementById("confirmPhoto");
      const closeModal = document.getElementById("closeModal");
      const cameraFeedDiv = document.getElementById("cameraFeedDiv");

      let stream = null;
      let currentImageBase64 = null;

      document.getElementById('scanButton').addEventListener('click', () => {
        modal.classList.remove("hidden");
        document.body.style.overflow = "hidden";
        showUploadTab();
      })

      function closeModalFunction() {
        modal.classList.add("hidden");
        document.body.style.overflow = "auto";
        stopCamera();
        resetUpload();
        resetCapture();
        currentImageBase64 = null;
      }

      function showUploadTab() {
        uploadTab.classList.add("border-indigo-500", "text-indigo-600");
        uploadTab.classList.remove(
          "border-transparent",
          "text-gray-500",
          "hover:text-gray-700",
          "hover:border-gray-300"
        );
        captureTab.classList.add(
          "border-transparent",
          "text-gray-500",
          "hover:text-gray-700",
          "hover:border-gray-300"
        );
        captureTab.classList.remove("border-indigo-500", "text-indigo-600");
        uploadContent.classList.remove("hidden");
        captureContent.classList.add("hidden");
        stopCamera();
      }

      function showCaptureTab() {
        captureTab.classList.add("border-indigo-500", "text-indigo-600");
        captureTab.classList.remove(
          "border-transparent",
          "text-gray-500",
          "hover:text-gray-700",
          "hover:border-gray-300"
        );
        uploadTab.classList.add(
          "border-transparent",
          "text-gray-500",
          "hover:text-gray-700",
          "hover:border-gray-300"
        );
        uploadTab.classList.remove("border-indigo-500", "text-indigo-600");
        uploadContent.classList.add("hidden");
        captureContent.classList.remove("hidden");
        startCamera();
      }

      function resetUpload() {
        fileUpload.value = "";
        previewContainer.classList.add("hidden");
        currentImageBase64 = null;
      }

      function resetCapture() {
        photoPreviewContainer.classList.add("hidden");
        cameraFeed.classList.remove("hidden");
        takePhoto.classList.remove("hidden");
        cameraFeedDiv.classList.remove("hidden");
        currentImageBase64 = null;
        startCamera();
      }

      // File upload handling
      fileUpload.addEventListener("change", function (e) {
        const file = e.target.files[0];
        if (file) {
          const reader = new FileReader();
          reader.onload = function (event) {
            imagePreview.src = event.target.result;
            previewContainer.classList.remove("hidden");
            currentImageBase64 = event.target.result.split(",")[1]; // Get base64 part
          };
          reader.readAsDataURL(file);
        }
      });

      // Camera functionality
      async function startCamera() {
        try {
          stream = await navigator.mediaDevices.getUserMedia({
            video: {
              facingMode: "environment",
              width: { ideal: 1280 },
              height: { ideal: 720 },
            },
          });
          cameraFeed.srcObject = stream;
        } catch (err) {
          console.error("Error accessing camera: ", err);
          alert("Could not access the camera. Please check permissions.");
        }
      }

      function stopCamera() {
        if (stream) {
          stream.getTracks().forEach((track) => track.stop());
          cameraFeed.srcObject = null;
          stream = null;
        }
      }

      takePhoto.addEventListener("click", function () {
        // Set canvas size to match video feed
        photoCanvas.width = cameraFeed.videoWidth;
        photoCanvas.height = cameraFeed.videoHeight;

        // Draw current frame from video to canvas
        const context = photoCanvas.getContext("2d");
        context.drawImage(
          cameraFeed,
          0,
          0,
          photoCanvas.width,
          photoCanvas.height
        );

        // Get base64 string
        currentImageBase64 = photoCanvas.toDataURL("image/jpeg").split(",")[1];

        // Show preview
        photoPreview.src = photoCanvas.toDataURL("image/jpeg");
        photoPreviewContainer.classList.remove("hidden");
        cameraFeed.classList.add("hidden");
        takePhoto.classList.add("hidden");
        cameraFeedDiv.classList.add("hidden");
        stopCamera();
      });

      // Function to send image to backend for detection
      async function detectObjects(imageBase64) {
        try {
          const csrfToken = document.querySelector(
            "[name=csrfmiddlewaretoken]"
          ).value;
          
          const response = await fetch("{% url 'detect' %}", {
            method: "POST",
            headers: {
              "X-CSRFToken": csrfToken,
            },
            body: JSON.stringify({ image: currentImageBase64}),
          });

          if (!response.ok) {
            throw new Error("Network response was not ok");
          }

          return await response.json();
        } catch (error) {
          console.error("Detection error:", error);
          throw error;
        }
      }

      // Button event listeners
      uploadTab.addEventListener("click", showUploadTab);
      captureTab.addEventListener("click", showCaptureTab);
      cancelUpload.addEventListener("click", resetUpload);
      retakePhoto.addEventListener("click", resetCapture);
      closeModal.addEventListener("click", closeModalFunction);

      // Handle image upload confirmation
      confirmUpload.addEventListener("click", async function () {
        if (!currentImageBase64) {
          alert("Please select an image first!");
          return;
        }

        try {
          confirmUpload.disabled = true;
          confirmUpload.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';

          const result = await detectObjects(currentImageBase64);

          if (result.success === "true") {
            let resultText = "Detected items:\n";
            for (const [item, count] of Object.entries(result.detected_items)) {
              resultText += `${item}: ${count}\n`;
            }
            alert(resultText);
          } else {
            throw new Error(result.error || "Detection failed");
          }
        } catch (error) {
          alert("Detection failed: " + error.message);
        } finally {
          confirmUpload.disabled = false;
          confirmUpload.textContent = "Confirm Upload";
        }
      });

      // Handle photo capture confirmation
      confirmPhoto.addEventListener("click", async function () {
        if (!currentImageBase64) {
          alert("Please take a photo first!");
          return;
        }

        try {
          confirmPhoto.disabled = true;
          confirmPhoto.innerHTML =
            '<i class="fas fa-spinner fa-spin mr-2"></i> Processing...';

          const result = await detectObjects(currentImageBase64);

          if (result.success === "true") {
            let resultText = "Detected items:\n";
            for (const [item, count] of Object.entries(result.detected_items)) {
              resultText += `${item}: ${count}\n`;
            }
            alert(resultText);
          } else {
            throw new Error(result.error || "Detection failed");
          }
        } catch (error) {
          alert("Detection failed: " + error.message);
        } finally {
          confirmPhoto.disabled = false;
          confirmPhoto.textContent = "Use Photo";
        }
      });

      // Close modal when clicking outside
      modal.addEventListener("click", function (e) {
        if (e.target === modal) {
          closeModalFunction();
        }
      });

        document.addEventListener("DOMContentLoaded", function() {
            fetchInventoryData();
        });
        
        function fetchInventoryData() {
            fetch("{% url 'test' %}")  
            .then(response => response.json())
            .then(data => {
                console.log('fetchInventoryData');
                updateInventoryAlerts(data.inventory_items);
            })
            .catch(error => console.error('Error fetching data:', error));
        }

        
        
        function updateInventoryAlerts(inventoryItems) {
            const alertsList = document.getElementById('inventoryAlertsList');
            const modalList = document.getElementById('modalInventoryList');
        
            if (!alertsList || !modalList) return;
        
            alertsList.innerHTML = ''; 
            modalList.innerHTML = '';
        
            // Sort inventory by expiry days
            inventoryItems.sort((a, b) => daysUntilExpiry(a.date_added) - daysUntilExpiry(b.date_added));
        
            let hasAlerts = false; 
        
            inventoryItems.forEach((item, index) => {
                let expiryDays = daysUntilExpiry(item.date_added);
                let alertMessage = '';
                let buttonClass = '';
                let buttonText = '';
        
                if (expiryDays <= 2) {  
                    alertMessage = `Expiring in ${expiryDays} days`;
                    buttonClass = 'bg-red-100 text-red-700';
                    buttonText = 'Use Fast';
                } else if (expiryDays <= 4) {  
                    alertMessage = `Expiring in ${expiryDays} days`;
                    buttonClass = 'bg-yellow-100 text-yellow-700';
                    buttonText = 'Use Soon';
                } else if (item.total_quantity < 5) {  
                    alertMessage = `Low stock - ${item.total_quantity} remaining`;
                    buttonClass = 'bg-indigo-100 text-indigo-700';
                    buttonText = 'Order';
                }
        
                if (alertMessage) {
                    hasAlerts = true;
                    const alertItem = `
                        <li class="py-3">
                            <div class="flex items-center">
                                <div class="min-w-0 flex-1">
                                    <p class="text-sm font-medium text-gray-900 truncate">${item.name}</p>
                                    <p class="text-sm text-gray-500">${alertMessage}</p>
                                </div>
                                <div>
                                    <button class="${buttonClass} py-1 px-3 rounded-full text-xs font-medium">
                                        ${buttonText}
                                    </button>
                                </div>
                            </div>
                        </li>
                    `;
        
                    // Show only the first 5 items in the main UI
                    if (index < 5) {
                        alertsList.innerHTML += alertItem;
                    }
        
                    // Add all items to the modal
                    modalList.innerHTML += alertItem;
                }
            });
        
            if (!hasAlerts) {
                alertsList.innerHTML = '<li class="py-3 text-gray-500 text-sm">No new alerts</li>';
            }
        }
        
        // Helper function: Calculate days until expiry
        function daysUntilExpiry(dateAdded) {
            const addedDate = new Date(dateAdded);
            const expiryDate = new Date(addedDate);
            expiryDate.setDate(expiryDate.getDate() + 7); 
        
            const today = new Date();
            const timeDiff = expiryDate - today;
            return Math.ceil(timeDiff / (1000 * 60 * 60 * 24));
        }
        
        // Auto-refresh inventory alerts every 30 seconds
        setInterval(fetchInventoryData, 30000);
        
        // Open and close modal functions
        function openModal() {
            document.getElementById("inventoryModal").classList.remove("hidden");
        }
        function close_inv_modal() {
            document.getElementById("inventoryModal").classList.add("hidden");
        }


        document.addEventListener("DOMContentLoaded", function () {
          fetch("{% url 'test' %}")
              .then(response => response.json())
              .then(data => {
                updateWasteOpportunities(data.waste_items);
                console.log('updateWasteOpportunities');
              })
              .catch(error => console.error("Error fetching waste data:", error));
      });
      
      function updateWasteOpportunities(wasteItems) {
          const wasteList = document.getElementById("waste-opportunities-list");
          if (!wasteList) {
              console.error("Waste list container not found!");
              return;
          }
          wasteList.innerHTML = "";
      
          if (wasteItems.length === 0) {
              wasteList.innerHTML = "<p class='text-sm text-gray-500'>No waste reduction opportunities available.</p>";
              return;
          }
      
          wasteItems.forEach(item => {
              const costReduction = (item.quantity * 2).toFixed(2); // Example calculation: $2 per unit of waste
      
              const listItem = document.createElement("li");
              listItem.classList.add("py-3");
      
              listItem.innerHTML = `
                  <div class="flex items-center">
                      <div class="min-w-0 flex-1">
                          <p class="text-sm font-medium text-gray-900 truncate">${item.name}</p>
                          <p class="text-sm text-gray-500">
                              Reduce waste by optimizing usage (${item.quantity} units wasted)
                          </p>
                      </div>
                      <div>
                          <span class="bg-red-100 text-red-700 py-1 px-3 rounded-full text-xs font-medium">
                              ${item.quantity} Units
                          </span>
                      </div>
                  </div>
              `;
      
              wasteList.appendChild(listItem);
          });
      }
      
      const changeSales = async () => {
        try {
            let response = await fetch("{% url 'test' %}");
            let data = await response.json();
    
            let mostSold = data.most_sold;  // Get top 2 sold items
            let leastSold = data.least_sold; // Get least 2 sold items
    
            // Update the HTML for "Top Performers"
            let topPerformersList = document.getElementById("top-performers-list");
            topPerformersList.innerHTML = ""; // Clear existing items
    
            mostSold.forEach(item => {
                let li = document.createElement("li");
                li.className = "flex justify-between items-center";
                li.innerHTML = `<span class="text-sm text-gray-700">${item.item}</span>
                                <span class="text-sm font-medium text-green-700">${item.quantity} sales</span>`;
                topPerformersList.appendChild(li);
            });
    
            // Update the HTML for "Underperforming"
            let underPerformingList = document.getElementById("underperforming-list");
            underPerformingList.innerHTML = ""; // Clear existing items
    
            leastSold.forEach(item => {
                let li = document.createElement("li");
                li.className = "flex justify-between items-center";
                li.innerHTML = `<span class="text-sm text-gray-700">${item.item}</span>
                                <span class="text-sm font-medium text-red-700">${item.quantity} sales</span>`;
                underPerformingList.appendChild(li);
            });
    
        } catch (error) {
            console.error("Error fetching data:", error);
        }
    };
    
    // Call function on page load
    window.onload = changeSales;
    
    
      
            </script>
            
  </body>
</html>
